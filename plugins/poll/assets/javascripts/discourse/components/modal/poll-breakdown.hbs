{{! template-lint-disable no-invalid-interactive }}
<DModal
  @title={{i18n "poll.breakdown.title"}}
  @closeModal={{@closeModal}}
  class="poll-breakdown has-tabs"
>
  <:headerBelowTitle>
    <ul class="modal-tabs">
      <li
        {{on "click" (fn (mut this.displayMode) "percentage")}}
        class={{concat-class
          "modal-tab percentage"
          (if (eq this.displayMode "percentage") "is-active")
        }}
      >
        {{i18n "poll.breakdown.percentage"}}
      </li>

      <li
        {{on "click" (fn (mut this.displayMode) "count")}}
        class={{concat-class
          "modal-tab count"
          (if (eq this.displayMode "count") "is-active")
        }}
      >
        {{i18n "poll.breakdown.count"}}
      </li>
    </ul>
  </:headerBelowTitle>

  <:body>
    <div class="poll-breakdown-sidebar">
      <p class="poll-breakdown-title">
        {{this.title}}
      </p>

      <div class="poll-breakdown-total-votes">
        {{i18n "poll.breakdown.votes" count=@model.poll.voters}}
      </div>

      <ul class="poll-breakdown-options">
        {{#each @model.poll.options as |option index|}}
          <PollBreakdownOption
            @option={{option}}
            @index={{index}}
            @totalVotes={{this.totalVotes}}
            @optionsCount={{@model.poll.options.length}}
            @displayMode={{this.displayMode}}
            @highlightedOption={{this.highlightedOption}}
            @onMouseOver={{fn (mut this.highlightedOption) index}}
            @onMouseOut={{fn (mut this.highlightedOption) null}}
          />
        {{/each}}
      </ul>
    </div>

    <div class="poll-breakdown-body">
      <div class="poll-breakdown-body-header">
        <label class="poll-breakdown-body-header-label">
          {{i18n "poll.breakdown.breakdown"}}
        </label>

        <ComboBox
          @content={{this.groupableUserFields}}
          @value={{this.groupedBy}}
          @nameProperty="label"
          @class="poll-breakdown-dropdown"
          @onChange={{this.setGrouping}}
        />
      </div>

      <div class="poll-breakdown-charts">
        {{#each this.charts as |chart|}}
          <PollBreakdownChart
            @group={{chart.group}}
            @options={{chart.options}}
            @displayMode={{this.displayMode}}
            @highlightedOption={{this.highlightedOption}}
            @setHighlightedOption={{fn (mut this.highlightedOption)}}
          />
        {{/each}}
      </div>
    </div>
  </:body>
</DModal>
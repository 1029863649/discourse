<Form
  @data={{this.model}}
  @onSubmit={{this.handleSubmit}}
  @validateOn="change"
  as |form data|
>
  <form.Field @name="enabled" @disabled={{this.readOnly}} as |field|>
    <field.Question
      @positiveLabel={{i18n "admin.badges.enabled"}}
      @negativeLabel={{i18n "admin.badges.disabled"}}
    />
  </form.Field>

  <form.Section @title="Design">
    <form.Field @name="badge_type_id" @disabled={{this.readOnly}} as |field|>
      <field.Select @title={{i18n "admin.badges.badge_type"}} as |select|>
        {{#each this.badgeTypes as |badgeType|}}
          <select.Option @value={{badgeType.id}}>
            {{badgeType.name}}
          </select.Option>
        {{/each}}
      </field.Select>
    </form.Field>

    <form.ConditionalContent
      @activeName={{if data.icon "choose-icon" "upload-image"}}
      as |cc|
    >
      <cc.Conditions as |condition|>
        <condition @name="choose-icon">
          {{i18n "admin.badges.select_an_icon"}}
        </condition>
        <condition @name="upload-image">
          {{i18n "admin.badges.upload_an_image"}}
        </condition>
      </cc.Conditions>
      <cc.Contents as |content|>
        <content @name="choose-icon">
          <form.Field @name="icon" as |field|>
            <field.Icon />
          </form.Field>
        </content>
        <content @name="upload-image">
          <form.Field
            @name="image_url"
            @onSet={{this.onSetImage}}
            @onUnset={{this.onUnsetImage}}
            as |field|
          >
            <field.Image />
          </form.Field>
        </content>
      </cc.Contents>
    </form.ConditionalContent>

    {{#if data.system}}
      <form.Container @title="Short Description">
        <LinkTo
          @route="adminSiteText.edit"
          @models={{array (concat this.textCustomizationPrefix "description")}}
          @query={{hash locale="en"}}
        >
          {{i18n "admin.badges.read_only_setting_help"}}
          {{d-icon "pencil-alt"}}
        </LinkTo>
      </form.Container>
    {{else}}
      <form.Field @name="description" @disabled={{data.system}} as |field|>
        <field.Text @title={{i18n "admin.badges.description"}} />
      </form.Field>
    {{/if}}

    {{#if data.system}}
      <form.Container @title="Long Description">
        <LinkTo
          @route="adminSiteText.edit"
          @models={{array
            (concat this.textCustomizationPrefix "long_description")
          }}
          @query={{hash locale="en"}}
        >
          {{i18n "admin.badges.read_only_setting_help"}}
          {{d-icon "pencil-alt"}}
        </LinkTo>
      </form.Container>
    {{else}}
      <form.Field @name="long_description" @disabled={{data.system}} as |field|>
        <field.Text @title={{i18n "admin.badges.long_description"}} />
      </form.Field>
    {{/if}}

  </form.Section>

  {{#if this.siteSettings.enable_badge_sql}}
    <form.Section @title="Query">
      <form.Field @name="query" as |field|>
        <field.Code @lang="sql" @title={{i18n "admin.badges.query"}} />
      </form.Field>

      {{#if data.query}}
        <form.InputGroup as |group|>
          <group.Button
            @isLoading={{this.preview_loading}}
            @label={{"admin.badges.preview.link_text"}}
            class="preview-badge"
            @action={{fn this.showPreview data "false"}}
          />
          <group.Button
            @isLoading={{this.preview_loading}}
            @label={{"admin.badges.preview.plan_text"}}
            class="preview-badge-plan"
            @action={{fn this.showPreview data "true"}}
          />
        </form.InputGroup>

        <form.Field @name="auto_revoke" @disabled={{this.readOnly}} as |field|>
          <field.Checkbox @label={{i18n "admin.badges.auto_revoke"}} />
        </form.Field>

        <form.Field @name="target_posts" @disabled={{this.readOnly}} as |field|>
          <field.Checkbox @label={{i18n "admin.badges.target_posts"}} />
        </form.Field>

        <form.Field @name="trigger" @disabled={{this.readOnly}} as |field|>
          <field.Select @title={{i18n "admin.badges.trigger"}} as |select|>
            {{#each this.badgeTriggers as |badgeType|}}
              <select.Option @value={{badgeType.id}}>
                {{badgeType.name}}
              </select.Option>
            {{/each}}
          </field.Select>
        </form.Field>
      {{/if}}

      <PluginOutlet
        @name="admin-above-badge-buttons"
        @outletArgs={{hash badge=this.buffered form=form}}
      />
    </form.Section>
  {{/if}}

  <form.Section @title="Settings">
    <form.Field
      @name="badge_grouping_id"
      @selection="Something"
      @disabled={{this.readOnly}}
      as |field|
    >
      <field.Menu
        @title={{i18n "admin.badges.badge_grouping"}}
        @selection={{(this.something data)}}
        as |menu|
      >
        {{#each this.badgeGroupings as |grouping|}}
          <menu.Item @value={{grouping.id}} @label={{grouping.name}} />
        {{/each}}
        <menu.Divider />
        <menu.Item
          @action={{route-action "editGroupings"}}
          @label="Add new group"
          class="btn-primary"
        />
      </field.Menu>
    </form.Field>

    <form.Field @name="allow_title" as |field|>
      <field.Checkbox @label={{i18n "admin.badges.allow_title"}} />
    </form.Field>

    <form.Field @name="multiple_grant" @disabled={{this.readOnly}} as |field|>
      <field.Checkbox @label={{i18n "admin.badges.multiple_grant"}} />
    </form.Field>

    <form.Field @name="listable" @disabled={{this.readOnly}} as |field|>
      <field.Checkbox @label={{i18n "admin.badges.listable"}} />
    </form.Field>

    <form.Field @name="show_posts" @disabled={{this.readOnly}} as |field|>
      <field.Checkbox @label={{i18n "admin.badges.show_posts"}} />
    </form.Field>
  </form.Section>
</Form>

{{!-- <section class="current-badge content-body">
  <div class="control-group current-badge__toggle-badge">
    <DToggleSwitch
      @state={{this.buffered.enabled}}
      @label={{this.badgeEnabledLabel}}
      {{on "click" this.toggleBadge}}
    />
  </div>

  <form class="form-horizontal">
    <div class="control-group">
      <label for="name">{{i18n "admin.badges.name"}}</label>
      {{#if this.readOnly}}
        <Input
          @type="text"
          name="name"
          @value={{this.buffered.name}}
          disabled={{true}}
        />
        <p class="help">
          <LinkTo
            @route="adminSiteText"
            @query={{hash q=(concat this.textCustomizationPrefix "name")}}
          >
            {{i18n "admin.badges.read_only_setting_help"}}
          </LinkTo>
        </p>
      {{else}}
        <Input @type="text" name="name" @value={{this.buffered.name}} />
      {{/if}}
    </div>



{{#if this.grant_count}}
  <div class="content-body current-badge-actions">
    <div>
      <LinkTo @route="badges.show" @model={{this}}>
        {{html-safe
          (i18n
            "badges.awarded"
            count=this.displayCount
            number=(number this.displayCount)
          )
        }}
      </LinkTo>
    </div>
  </div>
{{/if}} --}}
<PluginOutlet @name="above-user-profile" @connectorTagName="div" @args={{hash model=this.model}} />
<div class="container {{if this.viewingSelf "viewing-self"}} {{if this.model.profile_hidden "profile-hidden"}} {{this.primaryGroup}}">
  <DSection @class='user-main {{if showMobileUserMenu "show-mobile-profile-menu"}}'>
    <section class="{{if this.collapsedInfo "collapsed-info"}} about {{if this.hasProfileBackgroundUrl "has-background" "no-background"}}" >
      {{#unless this.collapsedInfo}}
        {{#if this.showStaffCounters}}
          <div class="staff-counters">
            {{#if this.model.number_of_flags_given}}
              <div><span class="helpful-flags">{{this.model.number_of_flags_given}}</span>{{i18n "user.staff_counters.flags_given"}}</div>
            {{/if}}
            {{#if this.model.number_of_flagged_posts}}
              <div>
                <LinkTo @route="review" @query={{hash username=this.model.username status="all" type="ReviewableFlaggedPost"}}>
                  <span class="flagged-posts">{{this.model.number_of_flagged_posts}}</span>{{i18n "user.staff_counters.flagged_posts"}}
                </LinkTo>
              </div>
            {{/if}}
            {{#if this.model.number_of_rejected_posts}}
              <div>
                <LinkTo @route="review" @query={{hash username=this.model.username status="rejected" type="ReviewableQueuedPost"}}>
                  <span class="flagged-posts">{{this.model.number_of_rejected_posts}}</span>{{i18n "user.staff_counters.rejected_posts"}}
                </LinkTo>
              </div>
            {{/if}}

            {{#if this.model.number_of_deleted_posts}}
              <div>
                <LinkTo @route="user.deletedPosts" @model={{this.model}}>
                  <span class="deleted-posts">{{this.model.number_of_deleted_posts}}</span>{{i18n "user.staff_counters.deleted_posts"}}
                </LinkTo>
              </div>
            {{/if}}
            {{#if this.model.number_of_suspensions}}
              <div>
                <a href {{action "showSuspensions"}}>
                  <span class="suspensions">{{this.model.number_of_suspensions}}</span>{{i18n "user.staff_counters.suspensions"}}
                </a>
              </div>
            {{/if}}
            {{#if this.model.warnings_received_count}}
              <div>
                <LinkTo @route="userPrivateMessages.warnings" @model={{this.model}}>
                  <span class="warnings-received">{{this.model.warnings_received_count}}</span>{{i18n "user.staff_counters.warnings_received"}}
                </LinkTo>
              </div>
            {{/if}}
          </div>
        {{/if}}
        <div class="user-profile-image" style={{this.model.profileBackgroundUrl}}></div>
      {{/unless}}
      <div class="details">
        <div class="primary">
          <PluginOutlet @name="before-user-profile-avatar" @args={{hash model=this.model}} />
          <UserProfileAvatar @user={{this.model}} @tagName="" />
          <section class="controls">
            <ul>
              {{#if this.model.can_send_private_message_to_user}}
                <li>
                  <DButton @class="btn-primary compose-pm" @action={{route-action "composePrivateMessage" this.model}} @icon="envelope" @label="user.private_message" />
                </li>
              {{/if}}
              {{#if this.canMuteOrIgnoreUser}}
                <li>
                  <UserNotificationsDropdown @user={{this.model}} @value={{this.userNotificationLevel}} @updateNotificationLevel={{action "updateNotificationLevel"}} />
                </li>
              {{/if}}
              {{#unless this.site.mobileView}}
                {{#if this.currentUser.staff}}
                  <li><a href={{this.model.adminPath}} class="btn btn-default">{{d-icon "wrench"}}<span class="d-button-label">{{i18n "admin.user.show_admin_profile"}}</span></a></li>
                {{/if}}
              {{/unless}}
              <PluginOutlet @name="user-profile-controls" @connectorTagName="li" @args={{hash model=this.model}} />

              {{#if this.canExpandProfile}}
                <li>
                  <DButton @ariaExpanded={{this.collapsedInfoState.isExpanded}} @ariaLabel={{this.collapsedInfoState.ariaLabel}} @ariaControls="collapsed-info-panel" @class="btn-default" @label={{concat "user." this.collapsedInfoState.label}} @icon={{this.collapsedInfoState.icon}} @action={{action this.collapsedInfoState.action}} />
                </li>
              {{/if}}

              {{#if this.site.mobileView}}
                <li>                
                  <DButton @class="btn-default toggle-mobile-user-menu" @action={{action "toggleMobileMenu" }} @icon="bars" @label="hamburger_menu" />
                </li>
              {{/if}}
            </ul>
          </section>

          <div class="primary-textual">
            <div class="user-profile-names">
              <h1 class={{if this.nameFirst "full-name" "username"}}>{{if this.nameFirst this.model.name (format-username this.model.username)}} {{user-status this.model currentUser=this.currentUser}}</h1>
              <h2 class={{if this.nameFirst "username" "full-name"}}>{{#if this.nameFirst}}{{this.model.username}}{{else}}{{this.model.name}}{{/if}}</h2>
              {{#if this.model.staged}}
                <h2 class="staged">{{i18n "user.staged"}}</h2>
              {{/if}}
              {{#if this.model.title}}
                <h3>{{this.model.title}}</h3>
              {{/if}}
              <PluginOutlet @name="user-post-names" @tagName="span" @connectorTagName="div" @args={{hash model=this.model}} />
            </div>

            {{#if this.showFeaturedTopic}}
              <h3 class="featured-topic">
                <span>{{i18n "user.featured_topic"}}</span>
                <LinkTo @route="topic" @models={{array this.model.featured_topic.slug this.model.featured_topic.id}}>{{html-safe (replace-emoji this.model.featured_topic.fancy_title)}}</LinkTo>
              </h3>
            {{/if}}

            <h3 class="location-and-website">
              {{#if this.model.location}}<div class="user-profile-location">{{d-icon "map-marker-alt"}} {{this.model.location}}</div>{{/if}}
              {{#if this.model.website_name}}
                <div class="user-profile-website">
                  {{d-icon "globe"}}
                  {{#if this.linkWebsite}}
                    {{!-- template-lint-disable  --}}
                    <a href={{this.model.website}} rel="noopener {{unless this.removeNoFollow 'nofollow ugc'}}" target="_blank">{{this.model.website_name}}</a>
                  {{else}}
                    <span title={{this.model.website}}>{{this.model.website_name}}</span>
                  {{/if}}
                </div>
              {{/if}}
              <PluginOutlet @name="user-location-and-website" @tagName="span" @connectorTagName="div" @args={{hash model=this.model}} />
            </h3>

            <div class='bio'>
              {{#if this.model.suspended}}
                <div class='suspended'>
                  {{d-icon "ban"}}
                  <b>
                    {{#if this.model.suspendedForever}}
                      {{i18n 'user.suspended_permanently'}}
                    {{else}}
                      {{i18n 'user.suspended_notice' date=this.model.suspendedTillDate}}
                    {{/if}}
                  </b>
                  <br>
                  {{#if this.model.suspend_reason}}
                    <b>{{i18n 'user.suspended_reason'}}</b> {{this.model.suspend_reason}}
                  {{/if}}
                </div>
              {{/if}}
              {{#if this.isNotSuspendedOrIsStaff}}
                <HtmlWithLinks>
                  {{html-safe this.model.bio_cooked}}
                </HtmlWithLinks>
              {{/if}}
            </div>

            {{#if this.publicUserFields}}
              <div class="public-user-fields">
                {{#each this.publicUserFields as |uf|}}
                  {{#if uf.value}}
                    <div class="public-user-field {{uf.field.dasherized_name}}">
                      <span class="user-field-name">{{uf.field.name}}</span>:
                      <span class="user-field-value">
                        {{#each uf.value as |v|}} {{! some values are arrays }}
                          <span class="user-field-value-list-item">{{v}}</span>
                        {{else }}
                          {{uf.value}}
                        {{/each}}
                      </span>
                    </div>
                  {{/if}}
                {{/each}}

                <PluginOutlet @name="user-profile-public-fields" @tagName="span" @connectorTagName="div" @args={{hash publicUserFields=this.publicUserFields
                                      model=this.model}} />
              </div>
            {{/if}}

            <PluginOutlet @name="user-profile-primary" @tagName="span" @connectorTagName="div" @args={{hash model=this.model}} />
          </div>
        </div>
        <PluginOutlet @name="user-profile-above-collapsed-info" @args={{hash model=this.model collapsedInfo=this.collapsedInfo}} />
        {{#unless this.collapsedInfo}}
          <div class='secondary' id='collapsed-info-panel'>
            <dl>
              {{#if this.model.created_at}}
                <div><dt>{{i18n 'user.created'}}</dt><dd>{{bound-date this.model.created_at}}</dd></div>
              {{/if}}
              {{#if this.model.last_posted_at}}
                <div><dt>{{i18n 'user.last_posted'}}</dt><dd>{{bound-date this.model.last_posted_at}}</dd></div>
              {{/if}}
              {{#if this.model.last_seen_at}}
                <div><dt>{{i18n 'user.last_seen'}}</dt><dd>{{bound-date this.model.last_seen_at}}</dd></div>
              {{/if}}
              {{#if this.model.profile_view_count}}
                <div><dt>{{i18n 'views'}}</dt><dd>{{this.model.profile_view_count}}</dd></div>
              {{/if}}
              {{#if this.model.invited_by}}
                <div><dt class="invited-by">{{i18n 'user.invited_by'}}</dt><dd class="invited-by"><LinkTo @route="user" @model={{this.model.invited_by}}>{{this.model.invited_by.username}}</LinkTo></dd></div>
              {{/if}}
              {{#if this.model.trust_level}}
                <div><dt class="trust-level">{{i18n 'user.trust_level'}}</dt><dd class="trust-level">{{this.model.trustLevel.name}}</dd></div>
              {{/if}}
              {{#if this.canCheckEmails}}
                <div><dt>{{i18n 'user.email.title'}}</dt>
                <dd title={{this.model.email}}>
                  {{#if this.model.email}}
                    {{this.model.email}}
                  {{else}}
                    <DButton @action={{route-action "checkEmail"}} @actionParam={{this.model}} @icon="far-envelope" @label="admin.users.check_email.text" @class="btn-primary" />
                  {{/if}}
                </dd>
                </div>
              {{/if}}
              {{#if this.model.displayGroups}}
                <div><dt class="groups">{{i18n 'groups.title' count=this.model.displayGroups.length}}</dt>
                <dd class='groups'>
                  {{#each this.model.displayGroups as |group|}}
                    <span><LinkTo @route="group" @model={{group.name}} class="group-link">{{group.name}}</LinkTo></span>
                  {{/each}}

                  <LinkTo @route="groups" @query={{hash username=this.model.username}}>
                    ...
                  </LinkTo>
                </dd>
                </div>
              {{/if}}

              {{#if this.canDeleteUser}}
                <div class='pull-right'><DButton @action={{action "adminDelete"}} @icon="exclamation-triangle" @label="user.admin_delete" @class="btn-danger" /></div>
              {{/if}}
            </dl>
            <PluginOutlet @name="user-profile-secondary" @tagName="span" @connectorTagName="div" @args={{hash model=this.model}} />
          </div>
        {{/unless}}
      </div>
    </section>
    <div class='user-content-wrapper'>
      <section class="user-primary-navigation">

      
        <ul class="main-nav nav nav-pills user-nav">
          {{#unless this.model.profile_hidden}}
            {{#if this.site.mobileView}}
              {{#if this.currentUser.staff}}
                <li class="user-primary-navigation_item"><a href={{this.model.adminPath}}>{{d-icon "wrench"}}<span class="d-button-label">{{i18n "admin.user.show_admin_profile"}}</span></a></li>
              {{/if}}
            {{/if}}
            <li class="summary user-primary-navigation_item"><LinkTo @route="user.summary">{{d-icon "info-circle"}}{{i18n 'user.summary.title'}}</LinkTo></li>
            <li class="activity user-primary-navigation_item-parent" onclick={{action 'toggleSubmenu'}}>
              <a class={{if (eq currentRouteParent "userActivity") "active" }}>
                {{d-icon "list-ul"}}{{i18n 'user.activity_stream'}}{{d-icon "chevron-down"}}
              </a>
             
                <ul class="user-primary-navigation_submenu activity-nav">
                  <DNavigationItem @route="userActivity.index">{{i18n "user.filters.all"}}</DNavigationItem>
                  <DNavigationItem @route="userActivity.topics">{{i18n "user_action_groups.4"}}</DNavigationItem>
                  <DNavigationItem @route="userActivity.replies">{{i18n "user_action_groups.5"}}</DNavigationItem>

                  {{#if this.user.showRead}}
                    <DNavigationItem @route="userActivity.read" @title={{i18n "user.read_help"}}>
                      {{i18n "user.read"}}
                    </DNavigationItem>
                  {{/if}}

                  {{#if this.user.showDrafts}}
                    <DNavigationItem @route="userActivity.drafts">
                      {{this.draftLabel}}
                    </DNavigationItem>
                  {{/if}}

                  {{#if (gt this.model.pending_posts_count 0)}}
                    <DNavigationItem @route="userActivity.pending">
                      {{this.pendingLabel}}
                    </DNavigationItem>
                  {{/if}}

                  <DNavigationItem @route="userActivity.likesGiven">{{i18n "user_action_groups.1"}}</DNavigationItem>
                  {{#if this.user.showBookmarks}}
                    <DNavigationItem @route="userActivity.bookmarks">{{i18n "user_action_groups.3"}}</DNavigationItem>
                  {{/if}}

                  <PluginOutlet @name="user-activity-bottom" @tagName="" @connectorTagName="" @args={{hash model=this.model}} />
                </ul>
             
            </li>
          {{/unless}}
          {{#if this.showNotificationsTab}}
            <li class="user-primary-navigation_item-parent user-notifications"  onclick={{action 'toggleSubmenu'}}>
              <a class={{if (eq currentRouteParent "userNotifications") "active" }}>
              {{d-icon "comment" class="glyph"}}{{i18n 'user.notifications'}}{{d-icon "chevron-down"}}
              </a> 
          
                <ul class="user-primary-navigation_submenu notifications-nav" >
                  <li>
                    <LinkTo @route="userNotifications.index">
                      {{i18n "user.filters.all"}}
                    </LinkTo>
                  </li>
                  <li>
                    <LinkTo @route="userNotifications.responses">
                      {{i18n "user_action_groups.6"}}
                    </LinkTo>
                  </li>
                  <li>
                    <LinkTo @route="userNotifications.likesReceived">
                      {{i18n "user_action_groups.2"}}
                    </LinkTo>
                  </li>
                  {{#if this.siteSettings.enable_mentions}}
                    <li>
                      <LinkTo @route="userNotifications.mentions">
                        {{i18n "user_action_groups.7"}}
                      </LinkTo>
                    </li>
                  {{/if}}
                  <li>
                    <LinkTo @route="userNotifications.edits">
                      {{i18n "user_action_groups.11"}}
                    </LinkTo>
                  </li>
                  <PluginOutlet @name="user-notifications-bottom" @tagName="span" @connectorTagName="li" @args={{hash model=this.model}} />
                </ul>
    
            </li>
          {{/if}}
          {{#if this.showPrivateMessages}}
            <li class="user-primary-navigation_item private-messages"><LinkTo @route="userPrivateMessages">{{d-icon "far-envelope"}}{{i18n 'user.private_messages'}}</LinkTo>
             
                   
            </li>
          {{/if}}
          {{#if this.canInviteToForum}}
            <li class="user-primary-navigation_item-parent invited" onclick={{action "toggleSubmenu"}}>
              <a class={{if (eq currentRouteParent "userInvited") "active" }}>
                {{d-icon "user-plus" class="glyph"}}{{i18n 'user.invited.title'}}{{d-icon "chevron-down"}}
              </a> 
              
           
             
                {{#if (or this.viewingSelf this.currentUser.staff)}}
                  <ul class="invites-nav user-primary-navigation_submenu" >
                    <NavItem  @route="userInvited.show" @routeParam="pending" @i18nLabel={{this.pendingLabel}} />
                    <NavItem  @route="userInvited.show" @routeParam="expired" @i18nLabel={{this.expiredLabel}} />
                    <NavItem  @route="userInvited.show" @routeParam="redeemed" @i18nLabel={{this.redeemedLabel}} />
                  </ul>
                {{/if}}
            
            </li>
          {{/if}}
          {{#if this.showBadges}}
            <li class="badges"><LinkTo @route="user.badges">{{d-icon "certificate"}}{{i18n 'badges.title'}}</LinkTo></li>
          {{/if}}
          <PluginOutlet @name="user-main-nav" @tagName="span" @connectorTagName="div" @tagName="" @connectorTagName="li" @args={{hash model=this.model}} />
          {{#if this.model.can_edit}}
            <li class="preferences user-primary-navigation_item-parent" onclick={{action 'toggleSubmenu'}}>
              <a class={{if (eq currentRouteParent "preferences") "active" }}>
                {{d-icon "cog"}}{{i18n 'user.preferences'}}{{d-icon "chevron-down"}}
              </a> 
             
                <ul class="user-primary-navigation_submenu preferences-nav">
                  <li class="user-primary-navigation_submenu-link nav-account">
                    <LinkTo @route="preferences.account">
                      {{i18n "user.preferences_nav.account"}}
                    </LinkTo>
                  </li>
                  <li class="user-primary-navigation_submenu-link nav-security">
                    <LinkTo @route="preferences.security">
                      {{i18n "user.preferences_nav.security"}}
                    </LinkTo>
                  </li>
                  <li class="user-primary-navigation_submenu-link nav-profile">
                    <LinkTo @route="preferences.profile">
                      {{i18n "user.preferences_nav.profile"}}
                    </LinkTo>
                  </li>
                  <li class="user-primary-navigation_submenu-link nav-emails">
                    <LinkTo @route="preferences.emails">
                      {{i18n "user.preferences_nav.emails"}}
                    </LinkTo>
                  </li>
                  <li class="user-primary-navigation_submenu-link nav-notifications">
                    <LinkTo @route="preferences.notifications">
                      {{i18n "user.preferences_nav.notifications"}}
                    </LinkTo>
                  </li>
                  {{#if this.model.can_change_tracking_preferences}}
                    <li class="indent user-primary-navigation_submenu-link  nav-categories">
                      <LinkTo @route="preferences.categories">
                        {{i18n "user.preferences_nav.categories"}}
                      </LinkTo>
                    </li>
                  {{/if}}
                  <li class="indent user-primary-navigation_submenu-link  nav-users">
                    <LinkTo @route="preferences.users">
                      {{i18n "user.preferences_nav.users"}}
                    </LinkTo>
                  </li>
                  {{#if (and this.model.can_change_tracking_preferences this.siteSettings.tagging_enabled)}}
                    <li class="indent user-primary-navigation_submenu-link  nav-tags">
                      <LinkTo @route="preferences.tags">
                        {{i18n "user.preferences_nav.tags"}}
                      </LinkTo>
                    </li>
                  {{/if}}
                  <li class="user-primary-navigation_submenu-link nav-interface">
                    <LinkTo @route="preferences.interface">
                      {{i18n "user.preferences_nav.interface"}}
                    </LinkTo>
                  </li>

                  {{#if this.siteSettings.enable_experimental_sidebar}}
                    <li class="indent user-primary-navigation_submenu-link  nav-sidebar">
                      <LinkTo @route="preferences.sidebar">
                        {{i18n "user.preferences_nav.sidebar"}}
                      </LinkTo>
                    </li>
                  {{/if}}

                  <PluginOutlet @name="user-preferences-nav-under-interface" @tagName="span" @connectorTagName="div" @args={{hash model=this.model}} />

                  {{#if this.model.userApiKeys}}
                    <li class="user-primary-navigation_submenu-link  nav-apps">
                      <LinkTo @route="preferences.apps">
                        {{i18n "user.preferences_nav.apps"}}
                      </LinkTo>
                    </li>
                  {{/if}}
                  <PluginOutlet @name="user-preferences-nav" @tagName="li" @args={{hash model=this.model}} />
                </ul>
              
            </li>
          {{/if}}
        </ul>
      </section>
    {{outlet}}
  </div>
  </DSection>
</div>

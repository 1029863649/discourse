production:
    first_thing:
    # 1. Permissions on postgres box
      - source: /.cloud66/scripts/permissions.sh
        destination: /tmp/scripts/permissions.sh
        target: postgresql
        apply_during: build_only
        execute: true
        sudo: true
    after_postgresql:
    # 2. Copy SQL image to PSQL server
      - source: /pg_dumps/production-image.sql
        destination: /tmp/images/production-image.sql
        target: postgresql
        apply_during: build_only
        owner: postgres
    after_rails:
    # 3. Set environment variables and allow PSQL user to access them
      - source: /.cloud66/scripts/env_vars.sh
        destination: /tmp/env_vars.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    # 4. KILL DB
      - source: /.cloud66/scripts/kill_db.sh
        destination: /tmp/kill_db.sh
        target: postgresql
        apply_during: build_only
        execute: true
        sudo: true
    # 5. DB:DROP & DB:CREATE
      - source: /.cloud66/scripts/drop_create.sh
        destination: /tmp/drop_create.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    # 6. Thin configurations
      - source: /.cloud66/scripts/thin.sh
        destination: /tmp/scripts/thin.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    # 7. Import database image
      - source: /.cloud66/scripts/import_prod.sh
        destination: /tmp/scripts/import_prod.sh
        target: postgresql
        apply_during: build_only
        execute: true
        owner: postgres
        run_as: postgres
    # 8. Migrate database
      - source: /.cloud66/scripts/migrate.sh
        destination: /tmp/migrate.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    last_thing:
    # 9. Curl script
      - source: /.cloud66/scripts/curl.sh
        destination: /tmp/curl.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
staging:
      after_rails:
      - source: /.cloud66/scripts/migrate.sh
        destination: /tmp/migrate.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    # 5. Thin configurations
      - source: /.cloud66/scripts/thin.sh
        destination: /tmp/scripts/thin.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
        parse: true
development:
    first_thing:
    # 1. Permissions on postgres box
      - source: /.cloud66/scripts/permissions.sh
        destination: /tmp/scripts/permissions.sh
        target: postgresql
        apply_during: build_only
        execute: true
        sudo: true
    after_postgresql:
    # 2. Copy SQL image to PSQL server
      - source: /pg_dumps/development-image.sql
        destination: /tmp/images/development-image.sql
        target: postgresql
        apply_during: build_only
        owner: postgres
    after_rails:
    # 3. Set environment variables and allow PSQL user to access them
      - source: /.cloud66/scripts/env_vars.sh
        destination: /tmp/env_vars.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    # 4. DB:DROP & DB:CREATE
      - source: /.cloud66/scripts/kill.sh
        destination: /tmp/kill.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    # 5. Thin configurations
      - source: /.cloud66/scripts/thin.sh
        destination: /tmp/scripts/thin.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
        parse: true
    last_thing:
    # 6. Import database image
      - source: /.cloud66/scripts/import_dev.sh
        destination: /tmp/scripts/import_dev.sh
        target: postgresql
        apply_during: build_only
        execute: true
        owner: postgres
        run_as: postgres
    # 7. Migrate database
      - source: /.cloud66/scripts/migrate.sh
        destination: /tmp/migrate.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    # 8. Curl script
      - source: /.cloud66/scripts/curl.sh
        destination: /tmp/curl.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
production:
    # 1. Copy SQL image to PSQL server
    after_postgresql:
      - source: /pg_dumps/production-image.sql
        destination: /tmp/images/production-image.sql
        target: postgresql
        apply_during: build_only
        owner: postgres
    # 2. Set environment variables and allow PSQL user to access them
    after_rails:
      - source: /.cloud66/scripts/env_vars.sh
        destination: /tmp/env_vars.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    # 3. DB:DROP & DB:CREATE
      - source: /.cloud66/scripts/kill.sh
        destination: /tmp/kill.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    # 4. Import database image
      - source: /.cloud66/scripts/import.sh
        destination: /tmp/scripts/import.sh
        target: postgresql
        apply_during: build_only
        execute: true
        owner: postgres
    # 5. Migrate database
      - source: /.cloud66/scripts/migrate.sh
        destination: /tmp/migrate.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true

########
staging:
    after_rails:
      - source: /.cloud66/scripts/first.sh
        destination: ~/first.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    after_rails:
      - source: /pg_dumps/production-image.sql
        destination: ~/dump.sh
        target: postgresql
        apply_during: build_only
    after_rails:
      - source: /.cloud66/scripts/dump.sh
        destination: ~/dump.sh
        target: postgresql
        apply_during: build_only
        execute: true
        sudo: true
    after_rails:
      - source: /.cloud66/scripts/third.sh
        destination: ~/third.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
development:
    after_rails:
      - source: /.cloud66/scripts/first.sh
        destination: ~/first.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true
    after_rails:
      - source: /pg_dumps/production-image.sql
        destination: ~/dump.sh
        target: postgresql
        apply_during: build_only
    after_rails:
      - source: /.cloud66/scripts/dump.sh
        destination: ~/dump.sh
        target: postgresql
        apply_during: build_only
        execute: true
        sudo: true
    after_rails:
      - source: /.cloud66/scripts/third.sh
        destination: ~/third.sh
        target: rails
        apply_during: build_only
        execute: true
        sudo: true